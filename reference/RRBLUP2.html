<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>RR-BLUP Model 2 — RRBLUP2 • AlphaSimR</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="RR-BLUP Model 2 — RRBLUP2"><meta name="description" content="Fits an RR-BLUP model for genomic predictions. This implementation is
meant for situations where RRBLUP is too slow. Note that
RRBLUP2 is only faster in certain situations, see details below. Most
users should use RRBLUP."><meta property="og:description" content="Fits an RR-BLUP model for genomic predictions. This implementation is
meant for situations where RRBLUP is too slow. Note that
RRBLUP2 is only faster in certain situations, see details below. Most
users should use RRBLUP."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">AlphaSimR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/AlphaSimR.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/DataImport.html">Data Import</a></li>
    <li><a class="dropdown-item" href="../articles/Genome.html">Genome</a></li>
    <li><a class="dropdown-item" href="../articles/GenomicSelection.html">Genomic Selection</a></li>
    <li><a class="dropdown-item" href="../articles/intro.html">Introduction to AlphaSimR</a></li>
    <li><a class="dropdown-item" href="../articles/Meiosis.html">Meiosis</a></li>
    <li><a class="dropdown-item" href="../articles/Misc.html">Misc</a></li>
    <li><a class="dropdown-item" href="../articles/QuantGen.html">Quantitative Genetics</a></li>
    <li><a class="dropdown-item" href="../articles/traits.html">Traits in AlphaSimR</a></li>
    <li><a class="dropdown-item" href="../articles/Traits.html">Traits</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gaynorr/AlphaSimR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>RR-BLUP Model 2</h1>
      <small class="dont-index">Source: <a href="https://github.com/gaynorr/AlphaSimR/blob/v1.6.0/R/GS.R" class="external-link"><code>R/GS.R</code></a></small>
      <div class="d-none name"><code>RRBLUP2.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fits an RR-BLUP model for genomic predictions. This implementation is
meant for situations where <code><a href="RRBLUP.html">RRBLUP</a></code> is too slow. Note that
RRBLUP2 is only faster in certain situations, see details below. Most
users should use <code><a href="RRBLUP.html">RRBLUP</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">RRBLUP2</span><span class="op">(</span></span>
<span>  <span class="va">pop</span>,</span>
<span>  traits <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  use <span class="op">=</span> <span class="st">"pheno"</span>,</span>
<span>  snpChip <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  useQtl <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  maxIter <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  Vu <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Ve <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  useEM <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1e-06</span>,</span>
<span>  simParam <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-pop">pop<a class="anchor" aria-label="anchor" href="#arg-pop"></a></dt>
<dd><p>a <code><a href="Pop-class.html">Pop-class</a></code> to serve as the training population</p></dd>


<dt id="arg-traits">traits<a class="anchor" aria-label="anchor" href="#arg-traits"></a></dt>
<dd><p>an integer indicating the trait to model, a trait name, or a
function of the traits returning a single value. Unlike <code><a href="RRBLUP.html">RRBLUP</a></code>,
only univariate models are supported.</p></dd>


<dt id="arg-use">use<a class="anchor" aria-label="anchor" href="#arg-use"></a></dt>
<dd><p>train model using phenotypes "pheno", genetic values "gv",
estimated breeding values "ebv", breeding values "bv", or randomly "rand"</p></dd>


<dt id="arg-snpchip">snpChip<a class="anchor" aria-label="anchor" href="#arg-snpchip"></a></dt>
<dd><p>an integer indicating which SNP chip genotype
to use</p></dd>


<dt id="arg-useqtl">useQtl<a class="anchor" aria-label="anchor" href="#arg-useqtl"></a></dt>
<dd><p>should QTL genotypes be used instead of a SNP chip.
If TRUE, snpChip specifies which trait's QTL to use, and thus these
QTL may not match the QTL underlying the phenotype supplied in traits.</p></dd>


<dt id="arg-maxiter">maxIter<a class="anchor" aria-label="anchor" href="#arg-maxiter"></a></dt>
<dd><p>maximum number of iterations.</p></dd>


<dt id="arg-vu">Vu<a class="anchor" aria-label="anchor" href="#arg-vu"></a></dt>
<dd><p>marker effect variance. If value is NULL, a
reasonable starting point is chosen automatically.</p></dd>


<dt id="arg-ve">Ve<a class="anchor" aria-label="anchor" href="#arg-ve"></a></dt>
<dd><p>error variance. If value is NULL, a
reasonable starting point is chosen automatically.</p></dd>


<dt id="arg-useem">useEM<a class="anchor" aria-label="anchor" href="#arg-useem"></a></dt>
<dd><p>use EM to solve variance components. If false,
the initial values are considered true.</p></dd>


<dt id="arg-tol">tol<a class="anchor" aria-label="anchor" href="#arg-tol"></a></dt>
<dd><p>tolerance for EM algorithm convergence</p></dd>


<dt id="arg-simparam">simParam<a class="anchor" aria-label="anchor" href="#arg-simparam"></a></dt>
<dd><p>an object of <code><a href="SimParam.html">SimParam</a></code></p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments if using a function for
traits</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The RRBLUP2 function works best when the number of markers is not
too large. This is because it solves the RR-BLUP problem by setting
up and solving Henderson's mixed model equations. Solving these equations
involves a square matrix with dimensions equal to the number of fixed
effects plus the number of random effects (markers). Whereas the <code><a href="RRBLUP.html">RRBLUP</a></code>
function solves the RR-BLUP problem using the EMMA approach. This approach involves
a square matrix with dimensions equal to the number of phenotypic records. This means
that the RRBLUP2 function uses less memory than RRBLUP when the number of markers
is approximately equal to or smaller than the number of phenotypic records.</p>
<p>The RRBLUP2 function is not recommend for cases where the variance components are
unknown. This is uses the EM algorithm to solve for unknown variance components,
which is generally considerably slower than the EMMA approach of <code><a href="RRBLUP.html">RRBLUP</a></code>.
The number of iterations for the EM algorithm is set by maxIter. The default value
is typically too small for convergence. When the algorithm fails to converge a
warning is displayed, but results are given for the last iteration. These results may
be "good enough". However we make no claim to this effect, because we can not generalize
to all possible use cases.</p>
<p>The RRBLUP2 function can quickly solve the mixed model equations without estimating variance
components. The variance components are set by defining Vu and Ve. Estimation of components
is suppressed by setting useEM to false. This may be useful if the model is being retrained
multiple times during the simulation. You could run <code><a href="RRBLUP.html">RRBLUP</a></code> function the first
time the model is trained, and then use the variance components from this output for all
future runs with the RRBLUP2 functions. Again, we can make no claim to the general robustness
of this approach.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#Create founder haplotypes</span></span></span>
<span class="r-in"><span><span class="va">founderPop</span> <span class="op">=</span> <span class="fu"><a href="quickHaplo.html">quickHaplo</a></span><span class="op">(</span>nInd<span class="op">=</span><span class="fl">10</span>, nChr<span class="op">=</span><span class="fl">1</span>, segSites<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Set simulation parameters</span></span></span>
<span class="r-in"><span><span class="va">SP</span> <span class="op">=</span> <span class="va"><a href="SimParam.html">SimParam</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">founderPop</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">SP</span><span class="op">$</span><span class="fu">addTraitA</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">SP</span><span class="op">$</span><span class="fu">setVarE</span><span class="op">(</span>h2<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">SP</span><span class="op">$</span><span class="fu">addSnpChip</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Create population</span></span></span>
<span class="r-in"><span><span class="va">pop</span> <span class="op">=</span> <span class="fu"><a href="newPop.html">newPop</a></span><span class="op">(</span><span class="va">founderPop</span>, simParam<span class="op">=</span><span class="va">SP</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Run GS model and set EBV</span></span></span>
<span class="r-in"><span><span class="va">ans</span> <span class="op">=</span> <span class="fu">RRBLUP2</span><span class="op">(</span><span class="va">pop</span>, simParam<span class="op">=</span><span class="va">SP</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pop</span> <span class="op">=</span> <span class="fu"><a href="setEBV.html">setEBV</a></span><span class="op">(</span><span class="va">pop</span>, <span class="va">ans</span>, simParam<span class="op">=</span><span class="va">SP</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Evaluate accuracy</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="gv.html">gv</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>, <span class="fu"><a href="ebv.html">ebv</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        est_GV_Trait1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Trait1      0.646779</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Chris Gaynor.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

